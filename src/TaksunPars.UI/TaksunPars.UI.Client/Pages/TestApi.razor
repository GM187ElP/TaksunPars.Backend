@page "/test-api"

<h3>Test API</h3>

<button @onclick="TestApiConnection" disabled="@_isLoading">Test API Connection</button>

<p>@_message</p>

@code {
    private string _message = "Click the button to test the API.";
    private bool _isLoading = false;

    private async Task TestApiConnection()
    {
        _isLoading = true;
        _message = "Testing API connection...";
        try
        {
            var response = await Http.GetAsync("test/ping");
            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadFromJsonAsync<ApiResponse>();
                _message = result?.Message ?? "No message received from the server.";
            }
            else
            {
                _message = $"Error: {response.StatusCode} - {response.ReasonPhrase}";
            }
        }
        catch (HttpRequestException httpEx)
        {
            _message = $"HTTP Error: {httpEx.Message}";
        }
        catch (Exception ex)
        {
            _message = $"Unexpected Error: {ex.Message}";
        }
        finally
        {
            _isLoading = false;
        }
    }

    [Inject] private HttpClient Http { get; set; } = default!;

    private class ApiResponse
    {
        public string Message { get; set; } = string.Empty;
    }
}
